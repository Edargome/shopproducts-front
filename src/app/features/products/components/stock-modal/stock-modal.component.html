<!-- Backdrop + modal "manual" -->
<div *ngIf="open" class="modal fade show d-block" tabindex="-1" role="dialog" aria-modal="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Modificar Stock</h5>
        <button type="button" class="btn-close" (click)="onClose()" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div *ngIf="product" class="mb-2">
          <div class="fw-semibold">{{ product.name }}</div>
          <div class="text-muted small">SKU: {{ product.sku }} Â· Stock actual: {{ product.stock }}</div>
        </div>

        <div *ngIf="alertMsg" class="alert" [ngClass]="{
          'alert-success': alertType === 'success',
          'alert-danger': alertType === 'danger',
          'alert-warning': alertType === 'warning',
          'alert-info': alertType === 'info'
        }">
          {{ alertMsg }}
        </div>

        <form [formGroup]="form">
          <div class="mb-3">
            <label class="form-label">Ajustar stock</label>
            <div class="input-group">
              <input type="number" class="form-control" formControlName="delta" [disabled]="loading" />
              <button class="btn btn-outline-secondary" type="button" (click)="adjust()" [disabled]="loading">
                Aplicar
              </button>
            </div>
            <div class="text-muted small">Usa el valor del inventario para fijar stock.</div>
          </div>

          <hr />

          <div class="mb-2">
            <label class="form-label">Descontar stock (qty)</label>
            <div class="input-group">
              <input type="number" class="form-control" formControlName="qty" [disabled]="loading" />
              <button class="btn btn-outline-danger" type="button" (click)="decrement()" [disabled]="loading">
                Disminuir
              </button>
            </div>
            <div class="text-muted small">Si no hay suficiente stock, la API debe devolver 409.</div>
          </div>
        </form>

        <div *ngIf="loading" class="text-muted small mt-2">Processing...</div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="onClose()">Cerrar</button>
      </div>

    </div>
  </div>
</div>

<div *ngIf="open" class="modal-backdrop fade show"></div>
