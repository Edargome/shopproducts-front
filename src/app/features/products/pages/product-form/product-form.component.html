<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h3 class="m-0">{{ isEdit ? 'Edit Product' : 'New Product' }}</h3>
      <div class="text-muted small" *ngIf="isEdit">ID: {{ id }}</div>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" (click)="back()">Back</button>
      <button class="btn btn-primary" (click)="submit()" [disabled]="saving || loading">
        {{ isEdit ? 'Save changes' : 'Create' }}
      </button>
    </div>
  </div>

  <div *ngIf="alertMsg" class="alert" [ngClass]="{
      'alert-success': alertType === 'success',
      'alert-danger': alertType === 'danger',
      'alert-warning': alertType === 'warning',
      'alert-info': alertType === 'info'
    }">
    {{ alertMsg }}
  </div>

  <div *ngIf="loading" class="alert alert-info">Loading...</div>

  <div class="row g-3">
    <div class="col-12 col-lg-7">
      <div class="card">
        <div class="card-header fw-semibold">Product info</div>
        <div class="card-body">
          <form [formGroup]="form" (ngSubmit)="submit()">
            <div class="mb-3">
              <label class="form-label">SKU</label>
              <input class="form-control" formControlName="sku" />
              <div class="text-danger small mt-1" *ngIf="f.sku.touched && f.sku.invalid">
                SKU is required (2-64 chars).
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Name</label>
              <input class="form-control" formControlName="name" />
              <div class="text-danger small mt-1" *ngIf="f.name.touched && f.name.invalid">
                Name is required (2-120 chars).
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="3" formControlName="description"></textarea>
            </div>

            <div class="row g-2">
              <div class="col-12 col-md-6">
                <label class="form-label">Price</label>
                <input type="number" class="form-control" formControlName="price" />
                <div class="text-danger small mt-1" *ngIf="f.price.touched && f.price.invalid">
                  Price must be >= 0
                </div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Stock</label>
                <input type="number" class="form-control" formControlName="stock" />
                <div class="text-danger small mt-1" *ngIf="f.stock.touched && f.stock.invalid">
                  Stock must be >= 0
                </div>
              </div>
            </div>

            <button type="submit" class="d-none">submit</button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      <div class="card">
        <div class="card-header fw-semibold">Stock actions</div>
        <div class="card-body">
          <div class="alert alert-secondary mb-3" *ngIf="!isEdit">
            Create the product first to enable stock actions.
          </div>

          <form [formGroup]="stockForm">
            <div class="mb-3">
              <label class="form-label">Adjust stock (delta)</label>
              <div class="input-group">
                <input type="number" class="form-control" formControlName="delta" [disabled]="!isEdit || stockLoading" />
                <button class="btn btn-outline-secondary" type="button"
                        (click)="adjustStock()"
                        [disabled]="!isEdit || stockLoading">
                  Apply
                </button>
              </div>
              <div class="text-muted small">Use negative to decrease, positive to increase.</div>
            </div>

            <hr>

            <div class="mb-3">
              <label class="form-label">Decrement stock (qty)</label>
              <div class="input-group">
                <input type="number" class="form-control" formControlName="qty" [disabled]="!isEdit || stockLoading" />
                <button class="btn btn-outline-danger" type="button"
                        (click)="decrementStock()"
                        [disabled]="!isEdit || stockLoading">
                  Decrement
                </button>
              </div>
              <div class="text-muted small">This should return 409 if insufficient stock.</div>
            </div>
          </form>

          <div *ngIf="stockLoading" class="text-muted small">Processing...</div>
        </div>
      </div>
    </div>
  </div>
</div>
